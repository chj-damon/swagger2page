{% import "./macros/ProFormFieldsTpl.njk" as fields %}

import { useRef } from 'react';

import {
  ProCard,
  ProForm,
  ProFormInstance,
  {{generateImportStr(config)}}
} from '@ant-design/pro-components';
import { useRequest } from 'ahooks';
import { Space, Row, Col } from 'antd';

import { {{requestName}} } from '{{apiImportPath}}';
import Title from '@/components/Title';
import useRefreshTrigger from '@/hooks/useRefreshTrigger';

const {{name}} = () => {
  const formRef = useRef<ProFormInstance>();

  const { navigateAndRefresh } = useRefreshTrigger();

  const handleFinish = async (values: any) => {
    try {
      await {{requestName}}(values);

      window.message.success('操作成功');
      navigateAndRefresh(REDIRECT_URL);
    } catch (error) {
      window.message.error((error as unknown as Error).message);
    }
  };

  return (
    <ProForm
      layout="horizontal"
      formRef={formRef}
      labelCol={% raw %}{{{% endraw %} span: {{labelCol}} {% raw %}}}{% endraw %}
      wrapperCol={% raw %}{{{% endraw %} span: {{wrapperCol}} {% raw %}}}{% endraw %}
      onFinish={handleFinish}
      autoFocusFirstInput={false}
      submitter={% raw %}{{{% endraw %}
        render: (_, doms) => {
          return (
            <ProCard>
              <Space>{doms}</Space>
            </ProCard>
          );
        },
      {% raw %}}}{% endraw %}
    >
      {% for item in hiddenItems %}
        <ProFormText name="{{item.name}}" hidden />
      {% endfor %}
      <Space direction="vertical" size={'middle'} style={{{% endraw %}{{ display: 'flex' }}{% endraw %}>>
        <div />
        <ProCard title={<Title text="设备基础信息" />}>
          {% for list in items %}
            <Row gutter={16}>
            {% for item in list %}
              <Col span={{ colSpan | curly }}>
                {% if item.componentType == 'text' %}
                  {{ fields.text(item.name, item.title, false, item.required) }}
                {% endif %}
                {% if item.componentType == 'captcha' %}
                  {{ fields.captcha(item.name, item.title, false, item.required) }}
                {% endif %}
                {% if item.componentType == 'password' %}
                  {{ fields.password(item.name, item.title, false, item.required) }}
                {% endif %}
                {% if item.componentType == 'digit' %}
                  {{ fields.digit(item.name, item.title, false, item.required) }}
                {% endif %}
                {% if item.componentType == 'digitRange' %}
                  {{ fields.digitRange(item.name, item.title, false, item.required) }}
                {% endif %}
                {% if item.componentType == 'textarea' %}
                  {{ fields.textarea(item.name, item.title, false, item.required) }}
                {% endif %}
                {% if item.componentType == 'date' %}
                  {{ fields.date(item.name, item.title, false, item.required) }}
                {% endif %}
                {% if item.componentType == 'dateTime' %}
                  {{ fields.dateTime(item.name, item.title, false, item.required) }}
                {% endif %}
                {% if item.componentType == 'dateRange' %}
                  {{ fields.dateRange(item.name, item.title, false, item.required) }}
                {% endif %}
                {% if item.componentType == 'dateTimeRange' %}
                  {{ fields.dateTimeRange(item.name, item.title, false, item.required) }}
                {% endif %}
                {% if item.componentType == 'time' %}
                  {{ fields.time(item.name, item.title, false, item.required) }}
                {% endif %}
                {% if item.componentType == 'select' %}
                  {{ fields.select(item.name, item.title, false, item.required) }}
                {% endif %}
                {% if item.componentType == 'treeSelect' %}
                  {{ fields.treeSelect(item.name, item.title, false, item.required) }}
                {% endif %}
                {% if item.componentType == 'checkbox' %}
                  {{ fields.checkbox(item.name, item.title, false, item.required) }}
                {% endif %}
                {% if item.componentType == 'radio' %}
                  {{ fields.radio(item.name, item.title, false, item.required) }}
                {% endif %}
                {% if item.componentType == 'cascader' %}
                  {{ fields.cascader(item.name, item.title, false, item.required) }}
                {% endif %}
                {% if item.componentType == 'slider' %}
                  {{ fields.slider(item.name, item.title, false, item.required) }}
                {% endif %}
                {% if item.componentType == 'switch' %}
                  {{ fields.switch(item.name, item.title, false, item.required) }}
                {% endif %}
                {% if item.componentType == 'rate' %}
                  {{ fields.rate(item.name, item.title, false, item.required) }}
                {% endif %}
                {% if item.componentType == 'uploadButton' %}
                  {{ fields.uploadButton(item.name, item.title, false, item.required) }}
                {% endif %}
                {% if item.componentType == 'uploadDragger' %}
                  {{ fields.uploadDragger(item.name, item.title, false, item.required) }}
                {% endif %}
                {% if item.componentType == 'money' %}
                  {{ fields.money(item.name, item.title, false, item.required) }}
                {% endif %}
                {% if item.componentType == 'segment' %}
                  {{ fields.segment(item.name, item.title, false, item.required) }}
                {% endif %}
              </Col>
            {% endfor %}
            </Row>
          {% endfor %}
        </ProCard>
      </Space>
    </ProForm>
  );
};

export default {{name}};
